{% extends "base.html" %}
{% block title  %}Home Index{% endblock  %}

{% block content %}
<h2>Home page</h2>
 
    <ul>
        {% for person in people  %}
           <li>{{ person }}<button onclick="deletePerson({{ person.pid }})">Delete</button><a href="{{ url_for('details', pid=person.pid) }}">Details</a></li><br>
        {% endfor %}
    </ul>

    <h3>New Person</h3>
    <form action="{{ url_for('index') }}" method="POST">
        <input type="text" name="name" placeholder="Name" required><br><br>
        <input type="number" name="age" placeholder="Age" required><br><br>
        <input type="text" name="job" placeholder="Job" required><br><br>
        <input type="submit" value="Add">
    </form>

    <script type="text/javascript">
        function deletePerson(pid){
            fetch('{{ url_for("delete", pid=pid) }}' + pid, {
                method: 'DELETE'
            }).then(response => {
                if(response.ok){
                    window.location.reload()
                }else{
                    console.log("Failed to delete item with pid: ", pid)
                }
            }).catch(error => {
                console.log("Error while deleting record: ", error)
            });
        };
    </script>
{% endblock  %}